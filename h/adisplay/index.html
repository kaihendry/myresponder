<!doctype html>
<html lang='en-GB'>
<head>
<meta charset='utf-8'>
<title>Alert display</title>
</head>
<body>
<div id='container'></div>
<script id='template' type='text/ractive'>
<p>On {{ Date(ts) }}, {{raiser.name}} raised an alert from {{raiser.address}}. The following responders were notified:</p>

<ol>
{{#guards}}
{{#result}}
<li>
{{#messages}}
{{name}} {{#this["message-id"]}} <a href=/report/{{this["message-id"]}}.json>SMS delivery report</a>{{/this["message-id"]}}
{{/messages}}
</li>
{{/result}}
{{/guards}}
</ol>

</script>
<script src='/ractive.min.js'></script>
<script>
function get(name){
	if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
	  return decodeURIComponent(name[1]);
}
xhr = new XMLHttpRequest();
xhr.open( 'get', get('j') );
xhr.onload = function () {
	var data = JSON.parse( xhr.responseText );
	var ractive = new Ractive({ el: '#container', template: '#template', data: data });
}
xhr.send();
</script>
</body>
</html>
